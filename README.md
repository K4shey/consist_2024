# Знакомство с компонентными тестами на БД

## Цель

Для асинхронного API по расчету добавить персистетность (проблематика, нужно чтобы данные по результатам не терялись после перезагрузки сервиса) 
- Добавить в API возможность "удалить" результат, но реально ничего удалять нельзя. 
- Добавить в API текстовое описание и возможность его менять через отдельный метод.

## Использованные технологии

- Java 17
- Spring boot 3
- JUnit 5
- Mockito
- Maven
- MapStruct 1.5.5
- PostgreSQL
- H2 Database

## Тестирование

В проекте реализовано микросервисное тестирование, помимо компонентных и модульных тестов.
Реализованы компонентные тесты для слоя репозитория. 

## Установка и запуск

- Выполните клонирование репозитория: `git clone https://gitlab.com/ваш_репозиторий.git`
- Откройте проект в вашей среде разработки (например, IntelliJ IDEA).
- Укажите токен авторизации пользователя в файле `application.properties`.
- Либо укажите токен в параметрах при запуске
  приложения: `java -jar task3-0.0.1-snapshot.jar --gitlab.token=ваш токен авторизации`
- Запустите приложение.
- Выполнив POST запрос на URL `/api/calcrequest` в параметр `expr` нужно передать выражение для вычисления. Например:`/api/calcrequest?expr=2+2`. Если нужно логирование в комментариях задачи, то дополнительно указываем параметр `needlog`. Например: `/api/calcrequest?expr=4+6&needlog=true`. В заголовке `Location` будет возвращён URL, содержащий id созданного выражения.
- После вычисления результата выражение будет помещено в базу данных.
- Для получения результата вычисления нужно выполнить GET запрос с указанием id выражения в URL. Например: `/api/calcrequest/2`. Если результат на момент запроса посчитан, то он будет возвращен в теле ответа. Иначе в статусе ответа будет информация, что выражение с требуемым id находится в обработке.   
- Сформировав GET запрос на URL `/api/calcrequest` можно получить список всех выражений, с указанием их id и текущего статуса.
- Сформировав DELETE запрос на URL `/api/calcrequest/{id}` можно удалить выражение с указанным id. Если нужно логирование в комментариях задачи, то дополнительно указываем параметр `needlog`.
- Сформировав PUT запрос на URL `/api/calcrequest/{id}` можно обновить выражение для вычисления, при условии что статус выражения `COMLPLETED`. Обновленное выражение отправляется для вычисления. Если нужно логирование в комментариях задачи, то дополнительно указываем параметр `needlog`.
- Сформировав PUT запрос на URL `/api/calcrequest/{id}/description` можно обновить описание вычисления. Например: `api/calcrequest/3/description?text=This is updated description`